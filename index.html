<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Research Desk - DailyRunner.Fun</title>
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            color: #f5f5f5;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            position: relative;
            /* Add this for proper layering */
        }

        #race-track {
            position: relative;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to top,
                    rgba(26, 26, 26, 0.7) 0%,
                    rgba(18, 18, 18, 0.7) 10%,
                    rgba(10, 10, 10, 0.7) 100%);
            display: flex;
            justify-content: center;
        }

        #start-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #4CAF50;
            z-index: 10;
        }

        #race-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to right,
                    rgba(76, 175, 80, 0.3) 0%,
                    rgba(33, 150, 243, 0.3) 100%);
            z-index: 5;
        }

        .token-racer {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80px;
            /* Reduced from 100px */
            transition: bottom 1s ease, left 1s ease;
            z-index: 15;
        }

        .token-icon-container {
            position: relative;
            width: 60px;
            height: 60px;
            margin-bottom: 5px;
            z-index: 12;
            /* Add this line */
        }

        .token-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #2196F3;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .token-icon:hover {
            transform: scale(1.15);
            z-index: 20;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.6);
        }

        /* Token name style */
        .token-name {
            margin-bottom: 0;
            /* Removed margin */
            background-color: rgba(36, 36, 36, 0.8);
            border-radius: 4px 4px 0 0;
            /* Rounded corners only on top */
            padding: 2px 6px;
            font-size: 0.8em;
            text-align: center;
            color: #ffffff;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 5;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            cursor: pointer;
            /* Added cursor pointer to indicate clickable */
        }

        /* Enhanced name hover effect */
        .token-racer.expanded .token-name {
            transform: scale(1.15);
            background-color: rgba(48, 48, 48, 0.95);
            z-index: 50;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.5);
            white-space: normal;
            max-width: 150px;
            word-break: break-word;
        }

        .token-market-cap {
            margin-top: 0;
            /* Removed margin */
            background-color: rgba(36, 36, 36, 0.8);
            border-radius: 0 0 4px 4px;
            /* Rounded corners only on bottom */
            padding: 2px 6px;
            font-size: 0.8em;
            text-align: center;
            color: #ffffff;
            transition: all 0.3s ease;
            /* Change from opacity to all */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            /* Add this */
            z-index: 5;
            /* Add this */
            cursor: pointer;
            /* Added cursor pointer to indicate clickable */
        }

        /* Enhanced market cap hover effect */
        .token-racer.expanded .token-market-cap {
            transform: scale(1.15);
            background-color: rgba(48, 48, 48, 0.95);
            z-index: 50;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.5);
        }

        /* Enhanced copy icon hover effects */
        .token-racer.expanded .copy-address-icon {
            transform: scale(1.3);
            background-color: rgba(33, 150, 243, 0.6);
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.3);
        }

        .copy-address-icon:hover {
            background-color: rgba(33, 150, 243, 0.8);
            transform: scale(1.5) !important;
            z-index: 30;
        }

        /* Enhanced social icons - IMPROVED */
        .social-icons {
            position: absolute;
            display: flex;
            bottom: -5px;
            left: -15px;
            z-index: 15;
            transition: all 0.4s ease;
            opacity: 0.7;
            /* Create a higher click area but initially hidden */
            padding: 10px;
            margin: -10px;
        }

        .token-icon-container:hover .social-icons {
            transform: translateY(-15px);
            /* Move up more to avoid overlap */
            opacity: 1;
            bottom: 0;
            /* Adjust position to avoid overlapping with other elements */
        }

        .social-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin: 0 4px;
            /* Equal margin on both sides */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            transform: scale(0.8);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0.9;
            overflow: hidden;
            /* Improve click target without changing visual size */
            position: relative;
        }

        /* Add an invisible larger click area */
        .social-icon::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            z-index: -1;
        }

        /* Enhanced hover effect for individual social icons */
        .token-icon-container:hover .social-icon {
            transform: scale(1.1);
            /* Slightly larger */
            opacity: 1;
            margin: 0 6px;
            /* Equal increased margin on both sides */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            /* Enhanced shadow */
        }

        /* Staggers the animation for each consecutive icon for a nice effect */
        .token-icon-container:hover .social-icon:nth-child(1) {
            transition-delay: 0s;
        }

        .token-icon-container:hover .social-icon:nth-child(2) {
            transition-delay: 0.05s;
        }

        .token-icon-container:hover .social-icon:nth-child(3) {
            transition-delay: 0.1s;
        }

        .social-icon:hover {
            transform: scale(1.3) !important;
            /* Much larger on hover */
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.7);
            z-index: 25;
            /* Ensure it's above other elements */
        }

        .social-icon.website {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }

        .social-icon.twitter {
            background: linear-gradient(135deg, #1DA1F2, #0077B5);
        }

        .social-icon.telegram {
            background: linear-gradient(135deg, #0088cc, #0056a3);
        }

        .social-icon svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        .token-info {
            background-color: rgba(36, 36, 36, 0.9);
            border-radius: 8px;
            padding: 8px;
            width: 240px;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            position: fixed;
            z-index: 1000;
            /* max-height: 350px; REMOVED */
            /* overflow-y: auto; REMOVED */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            font-size: 0.85em;
            pointer-events: none;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .token-info.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .token-info-header {
            text-align: center;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Added - Social icons in the tooltip */
        .token-info-social-icons {
            display: flex;
            justify-content: center;
            margin-top: 8px;
            gap: 12px;
        }

        .token-info-social-icon {
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .token-info-social-icon:hover {
            transform: scale(1.2);
        }

        .token-info-social-icon svg {
            width: 18px;
            height: 18px;
            fill: white;
        }

        .farm-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-top: 2px;
            font-weight: bold;
        }

        .farm-status-FARM {
            background-color: rgba(244, 67, 54, 0.3);
            color: #F44336;
        }

        .farm-status-FARMED {
            background-color: rgba(255, 193, 7, 0.3);
            color: #FFC107;
        }

        /* Style for fake distribution tag */
        .fake-distribution-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-top: 2px;
            font-weight: bold;
            background-color: rgba(233, 30, 99, 0.3);
            color: #E91E63;
        }

        .token-info-section {
            margin-bottom: 4px;
        }

        .token-info-label {
            color: #aaa;
            font-size: 0.85em;
        }

        .token-info-value {
            word-break: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: 0.9em;
        }

        .token-info-value-ai {
            word-break: normal;
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: 0.9em;
        }

        .token-info-links a {
            color: #2196F3;
            text-decoration: none;
            margin-right: 8px;
            font-size: 0.9em;
        }

        .token-info-links a:hover {
            text-decoration: underline;
        }

        .token-info-badge {
            display: inline-block;
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 0.75em;
            margin-right: 3px;
        }

        .badge-true {
            background-color: rgba(76, 175, 80, 0.3);
        }

        .badge-false {
            background-color: rgba(244, 67, 54, 0.3);
        }

        .wallet-metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }

        .wallet-value {
            font-weight: bold;
        }

        .wallet-value-high {
            color: #F44336;
        }

        .wallet-value-medium {
            color: #FFC107;
        }

        .wallet-value-low {
            color: #4CAF50;
        }

        #race-header {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 30;
            padding-bottom: 10px;
            background: linear-gradient(to bottom, rgba(18, 18, 18, 1) 0%, rgba(18, 18, 18, 0.8) 80%, rgba(18, 18, 18, 0) 100%);
        }

        #race-header h1 {
            color: #4CAF50;
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        #race-header p {
            color: #aaa;
            margin: 5px 0;
        }

        #timeline {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.1);
            z-index: 5;
        }

        .toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.9em;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .toast-notification.show {
            opacity: 1;
        }

        /* Token expansion on hover */
        .token-racer.expanded {
            z-index: 50;
        }

        /* Animation for tooltip */
        @keyframes tooltipPulse {
            0% {
                box-shadow: 0 0 0 rgba(33, 150, 243, 0.4);
            }

            50% {
                box-shadow: 0 0 10px rgba(33, 150, 243, 0.7);
            }

            100% {
                box-shadow: 0 0 0 rgba(33, 150, 243, 0.4);
            }
        }

        .token-info.visible {
            animation: tooltipPulse 2s infinite;
        }

        /* Filter Toggle Switch */
        .filter-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            margin-left: 10px;
            color: #aaa;
            font-size: 0.9em;
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
            width: 0;
            height: 0;
            /* duplicated in original but keeping for safety */
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: #F44336;
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #F44336;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 24px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Last updated timestamp container */
        #last-updated-container {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: rgba(36, 36, 36, 0.8);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            color: #aaa;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        #last-updated-container:hover {
            background-color: rgba(36, 36, 36, 0.95);
        }

        #refresh-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            background-color: #4CAF50;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #refresh-indicator.active {
            opacity: 1;
        }

        /* Dashboard Button Styles */
        #dashboard-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            text-decoration: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 100;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            border: none;
            font-family: 'Arial', sans-serif;
            font-size: 0.9em;
        }

        #dashboard-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        #dashboard-button svg {
            margin-right: 6px;
            width: 16px;
            height: 16px;
        }

        /* Add style for scan incomplete status */
        .scan-status-incomplete {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-top: 2px;
            font-weight: bold;
            background-color: rgba(156, 39, 176, 0.3);
            color: #9C27B0;
        }

        /* Copy icon styles */
        .copy-address-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: rgba(33, 150, 243, 0.3);
            margin-right: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .copy-address-icon::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            z-index: -1;
        }

        .copy-address-icon:hover {
            background-color: rgba(33, 150, 243, 0.5);
            transform: scale(1.2);
        }

        .copy-address-icon svg {
            width: 10px;
            height: 10px;
            fill: white;
        }

        /* CSS changes to stack the filter controls */
        .filter-row {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        /* New styles for the market cap slider */
        .range-slider-container {
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .range-slider {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #4CAF50, #2196F3);
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .range-slider:hover {
            opacity: 1;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .range-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .range-slider-value {
            color: #ffffff;
            font-size: 0.9em;
            margin-top: 5px;
            background-color: rgba(36, 36, 36, 0.8);
            padding: 2px 8px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* Media queries */
        @media (max-width: 768px) {
            #race-header h1 {
                font-size: 1.5em;
            }

            .token-icon-container {
                width: 40px;
                height: 40px;
            }

            .token-icon {
                width: 40px;
                height: 40px;
            }

            .token-racer {
                width: 60px;
            }

            /* Hide market cap labels completely on tablets and smaller devices */
            .token-market-cap {
                display: none !important;
            }

            /* Hide token name completely on tablets and smaller devices */
            .token-name {
                display: none !important;
            }

            /* Hide social icons completely on iPad size screens and smaller */
            .social-icons {
                display: none !important;
            }

            /* Hide copy address icon on mobile */
            .copy-address-icon {
                display: none !important;
            }

            /* Disable all tooltip functionality for mobile */
            .token-info {
                display: none !important;
            }

            /* Disable the tooltip hover effects for mobile - any element with mouseenter events */
            .token-icon-container {
                pointer-events: none;
            }

            /* But restore click events just for the token icon for navigation */
            .token-icon {
                pointer-events: auto;
                cursor: pointer;
            }

            /* Hide the Simple View toggle on smaller screens */
            .simple-view-row {
                display: none !important;
            }

            .filter-label {
                font-size: 0.8em;
            }

            #last-updated-container {
                font-size: 0.7em;
                padding: 3px 8px;
            }

            /* Hide the last updated container */
            #last-updated-container {
                display: none !important;
            }

            #finish-line {
                top: 160px;
                /* Increased from 110px */
            }

            #finish-line::after {
                font-size: 0.7em;
            }

            /* Adjust slider for mobile */
            .range-slider {
                height: 6px;
            }

            .range-slider::-webkit-slider-thumb {
                width: 16px;
                height: 16px;
            }

            .range-slider::-moz-range-thumb {
                width: 16px;
                height: 16px;
            }
        }

        /* Replace the existing 480px media query with this updated version */
        @media (max-width: 480px) {
            #race-header h1 {
                font-size: 1.2em;
            }

            .token-icon-container {
                width: 30px;
                height: 30px;
            }

            .token-icon {
                width: 30px;
                height: 30px;
                border-width: 2px;
            }

            .token-racer {
                width: 50px;
            }

            /* Note: We don't need styles for hidden elements */
            /* .token-market-cap, .social-icon, .token-info styles removed */

            .switch {
                width: 40px;
                height: 20px;
            }

            .slider:before {
                height: 14px;
                width: 14px;
                left: 3px;
                bottom: 3px;
            }

            input:checked+.slider:before {
                transform: translateX(20px);
            }

            .filter-label {
                font-size: 0.7em;
            }

            #last-updated-container {
                font-size: 0.6em;
                padding: 2px 6px;
            }

            /* Make the race track fill more screen space on small devices */
            #race-track {
                height: calc(100vh - 20px);
            }

            /* Make dashboard button smaller on very small screens */
            #dashboard-button {
                font-size: 0.65em;
                padding: 4px 6px;
            }

            /* Hide the last updated container */
            #last-updated-container {
                display: none !important;
            }

            #finish-line {
                top: 140px;
                /* Increased from 90px */
            }

            #finish-line::after {
                font-size: 0.6em;
                right: 5px;
                top: -15px;
            }

            /* Further adjust slider for small screens */
            .range-slider-container {
                max-width: 220px;
            }

            .range-slider {
                height: 5px;
            }

            .range-slider::-webkit-slider-thumb {
                width: 14px;
                height: 14px;
            }

            .range-slider::-moz-range-thumb {
                width: 14px;
                height: 14px;
            }

            .range-slider-value {
                font-size: 0.7em;
                padding: 1px 5px;
            }
        }

        /* Replace the existing finish line CSS with this */
        #finish-line {
            position: absolute;
            top: 180px;
            left: 0;
            width: 100%;
            height: 20px;
            /* Doubled to 20px for two rows of checkers */
            z-index: 8;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        /* Keep the finish line label with updated styling */
        #finish-line::after {
            content: "10M Market Cap";
            position: absolute;
            right: 10px;
            top: -20px;
            font-size: 0.8em;
            color: #ffffff;
            /* Changed from blue to black for better contrast */
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
            /* Add text shadow for readability */
            font-weight: bold;
        }

        /* Add media queries to make the finish line responsive */
        @media (max-width: 768px) {
            #finish-line {
                height: 16px;
                /* Smaller on tablets but still has two rows */
                background-size: 100% 8px;
                background-position: 0 0, 0 8px;
            }
        }

        @media (max-width: 480px) {
            #finish-line {
                height: 12px;
                /* Smaller on mobile but still has two rows */
                background-size: 100% 6px;
                background-position: 0 0, 0 6px;
            }
        }

        /* SIMPLE VIEW MODE - New CSS to hide elements when simple view is active */
        .simple-view .token-name,
        .simple-view .token-market-cap,
        .simple-view .copy-address-icon,
        .simple-view .social-icons,
        .simple-view .classification-indicator {
            display: none !important;
        }

        /* Disable tooltips in simple view */
        .simple-view .token-info {
            pointer-events: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        /* Simple view icon-only style */
        .simple-view .token-icon-container {
            margin-bottom: 0;
        }

        /* Different background color for simple view slider */
        input#simple-view-filter:checked+.slider {
            background-color: #2196F3;
            /* Blue instead of red */
        }

        /* CSS for fallback black token placeholder */
        .token-icon.placeholder {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #444;
            font-size: 10px;
            overflow: hidden;
        }

        /* Add these new styles for the background image and tint */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2;
        }

        /* Tint/overlay layer */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            /* Adjust opacity here (0.7 = 70% opaque) */
            z-index: -1;
        }

        #race-header h1 {
            color: #4CAF50;
            margin: 0;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-logo {
            height: 1em;
            width: auto;
            margin-right: 10px;
            vertical-align: middle;
        }

        /* Dropdown Menu Styles */
        .menu-dropdown {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
        }

        .menu-button {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-family: 'Arial', sans-serif;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .menu-button svg {
            width: 16px;
            height: 16px;
            margin-right: 6px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 5px;
            background-color: rgba(36, 36, 36, 0.95);
            min-width: 160px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            z-index: 101;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-content a {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.2s;
        }

        .dropdown-content a:hover {
            background-color: rgba(76, 175, 80, 0.2);
        }

        .show {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Optional: Add separator between Dashboard and other menu items */
        .dropdown-content a.separator-top {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 4px;
            padding-top: 12px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Media queries for responsive menu */
        @media (max-width: 768px) {
            .menu-button {
                padding: 6px 10px;
                font-size: 0.8em;
            }

            .menu-button svg {
                width: 14px;
                height: 14px;
            }
        }

        @media (max-width: 480px) {
            .menu-button {
                padding: 5px 8px;
                font-size: 0.7em;
            }

            .menu-button svg {
                width: 12px;
                height: 12px;
            }

            .dropdown-content {
                min-width: 140px;
            }

            .dropdown-content a {
                padding: 10px 14px;
                font-size: 0.9em;
            }
        }

        /* NEW CLASSIFICATION INDICATORS AROUND TOKEN IMAGES */
        .classification-indicator {
            position: absolute;
            width: 22px;
            height: 22px;
            font-size: 15px;
            z-index: 16;
            display: flex;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.7));
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .token-icon-container:hover .classification-indicator {
            transform: scale(1.2);
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* Position indicators around the circle */
        .classification-indicator.pos-top {
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .classification-indicator.pos-top-right {
            top: 0;
            right: -5px;
        }

        .classification-indicator.pos-right {
            top: 50%;
            right: -8px;
            transform: translateY(-50%);
        }

        .classification-indicator.pos-bottom-right {
            bottom: 0;
            right: -5px;
        }

        .classification-indicator.pos-bottom {
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
        }

        .classification-indicator.pos-bottom-left {
            bottom: 0;
            left: -5px;
        }

        .classification-indicator.pos-left {
            top: 50%;
            left: -8px;
            transform: translateY(-50%);
        }

        .classification-indicator.pos-top-left {
            top: 0;
            left: -5px;
        }

        /* Adjust for smaller screens */
        @media (max-width: 768px) {
            .classification-indicator {
                width: 18px;
                height: 18px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .classification-indicator {
                width: 16px;
                height: 16px;
                font-size: 10px;
            }
        }

        /* Settings gear button styles */
        #filter-settings-button {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-family: 'Arial', sans-serif;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            margin: 10px auto;
        }

        #filter-settings-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        #filter-settings-button svg {
            width: 16px;
            height: 16px;
            margin-right: 6px;
        }

        #filter-settings-container {
            display: none;
            background-color: rgba(36, 36, 36, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 90%;
            margin: 10px auto;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            position: relative;
        }

        .settings-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-section-title {
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2196F3;
        }

        .classification-filters-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }

        .settings-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        /* Token classification tag styles */
        .classification-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 3px;
            margin-top: 2px;
            font-weight: bold;
        }

        .classification-memecoin {
            background-color: rgba(255, 152, 0, 0.3);
            color: #FF9800;
        }

        .classification-utility {
            background-color: rgba(0, 150, 136, 0.3);
            color: #009688;
        }

        .classification-ai {
            background-color: rgba(33, 150, 243, 0.3);
            color: #2196F3;
        }

        .classification-tweet {
            background-color: rgba(156, 39, 176, 0.3);
            color: #9C27B0;
        }

        .classification-current-event {
            background-color: rgba(233, 30, 99, 0.3);
            color: #E91E63;
        }

        .classification-animals {
            background-color: rgba(121, 85, 72, 0.3);
            color: #795548;
        }

        .classification-political {
            background-color: rgba(63, 81, 181, 0.3);
            color: #3F51B5;
        }

        .classification-racist {
            background-color: rgba(244, 67, 54, 0.3);
            color: #F44336;
        }

        .classification-offensive {
            background-color: rgba(255, 87, 34, 0.3);
            color: #FF5722;
        }

        /* Custom toggle switch colors for classification filters */
        input#memecoin-filter:checked+.slider {
            background-color: #FF9800;
            /* Orange for memecoins */
        }

        input#utility-filter:checked+.slider {
            background-color: #009688;
            /* Teal for utility */
        }

        input#ai-filter:checked+.slider {
            background-color: #2196F3;
            /* Blue for AI */
        }

        input#tweet-filter:checked+.slider {
            background-color: #9C27B0;
            /* Purple for tweet */
        }

        input#current-event-filter:checked+.slider {
            background-color: #E91E63;
            /* Pink for current event */
        }

        /* Score Graph Styles */
        .token-info-section {
            padding: 10px;
            border-bottom: 1px solid #333;
        }

        .score-section {
            margin-top: 8px;
            border-top: 1px solid #333;
            padding-top: 5px;
        }

        .score-head {
            font-size: 11px;
            color: #aaa;
            margin-bottom: 4px;
            font-weight: bold;
        }

        .score-row {
            display: flex;
            align-items: center;
            margin-bottom: 3px;
            font-size: 10px;
        }

        .score-name {
            width: 70px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #ccc;
        }

        .score-bar-bg {
            flex-grow: 1;
            height: 5px;
            background: #444;
            border-radius: 2px;
            overflow: hidden;
            margin: 0 6px;
        }

        .score-bar-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
        }

        .score-val {
            width: 20px;
            text-align: right;
            color: #fff;
            font-family: monospace;
        }

        .token-info-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 2px;
        }

        input#animals-filter:checked+.slider {
            background-color: #795548;
            /* Brown for animals */
        }

        input#political-filter:checked+.slider {
            background-color: #3F51B5;
            /* Indigo for political */
        }

        input#racist-filter:checked+.slider {
            background-color: #F44336;
            /* Red for racist */
        }

        input#offensive-filter:checked+.slider {
            background-color: #FF5722;
            /* Deep orange for offensive */
        }
    </style>
    <script src="ddos-protection.js" defer></script>
</head>

<body>
    <!-- Menu and header structure from reference -->
    <div class="menu-dropdown"><button class="menu-button" onclick="toggleMenu()"><svg
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
            </svg>Menu </button>
        <div id="dropdown-menu" class="dropdown-content">
            <a href="/">Agent Desk</a>
            <a href="/new_pairs.html">New Pairs</a>
            <a href="/dashboard.html">Dashboard</a>
            <a href="/trending.html">Trending</a>
            <a href="/documentation.html">Documentation</a>
            <a href="/privacy.html" class="separator-top">Privacy Policy</a>
            <a href="/disclaimer.html">Disclaimer</a>
            <a href="/termsofservice.html">Terms of Service</a>
        </div>
    </div>
    <div id="race-header">
        <h1><img src="logo.png" alt="Logo" class="header-logo">Agent Research Desk</h1><button
            id="filter-settings-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                <path
                    d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
            </svg>Filter Settings </button>
        <div id="filter-settings-container">

            <div class="settings-section">
                <div class="settings-section-title">Market Cap Filter</div>
                <div class="range-slider-container"><input type="range" id="market-cap-slider" min="50000" max="500000"
                        step="10000" value="100000" class="range-slider">
                    <div class="range-slider-value">Min Market Cap: $<span id="market-cap-value">100k</span></div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">Other Filters</div>
                <div class="filter-row">
                    <div class="filter-group" style="margin-left: 20px;"><label class="switch"><input type="checkbox"
                                id="simple-view-filter"><span class="slider round"></span></label><span
                            class="filter-label">Simple
                            View</span></div>
                </div>
            </div>

            <div class="settings-section">
                <div class="settings-section-title">Token Classifications</div>
                <div class="classification-filters-container">
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="memecoin-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üòÇ
                            Memecoin</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="utility-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üõ†Ô∏è
                            Utility</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="ai-filter" checked><span
                                class="slider round"></span></label><span class="filter-label">ü§ñ AI Token</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="tweet-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üì± Tweet
                            Coin</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="current-event-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üì∞ Current
                            Event</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="animals-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üê±
                            Animals</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="political-filter"
                                checked><span class="slider round"></span></label><span class="filter-label">üèõÔ∏è
                            Political</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="racist-filter"><span
                                class="slider round"></span></label><span class="filter-label">üò≠ Racist</span></div>
                    <div class="filter-group"><label class="switch"><input type="checkbox" id="offensive-filter"><span
                                class="slider round"></span></label><span class="filter-label">üò° Offensive</span></div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div id="race-track">
        <div id="start-line"></div>
        <div id="finish-line"></div>
        <div id="race-progress"></div>
        <div id="timeline"></div>
    </div>
    <div id="toast" class="toast-notification"></div>
    <div id="last-updated-container"><span id="refresh-indicator"></span><span id="last-updated-text">Last updated:
            -</span></div>
    <script>class TokenRace {
            constructor() {
                this.raceTracks = document.getElementById('race-track');
                this.startingMarketCap = 50000;
                this.maxMarketCapDisplay = 10000000;
                this.headerHeight = 0;
                this.maxDisplayHeight = 0;
                this.tokens = [];
                this.filteredTokens = [];
                this.earliestTimestamp = null;
                this.latestTimestamp = null;
                this.activeInfoPanel = null;
                this.toastElement = document.getElementById('toast');
                this.useLogScale = true;
                this.scaleFactor = 1;
                this.minMarketCapFilter = 0; // DEBUG: Lowered to 0
                this.simpleViewEnabled = false;

                // DEBUG: Create on-screen console
                // this.debugConsole = document.createElement('div');
                // this.debugConsole.style.cssText = 'position:fixed;bottom:0;left:0;width:100%;height:150px;background:rgba(0,0,0,0.8);color:#0f0;font-family:monospace;font-size:12px;overflow-y:scroll;z-index:9999;padding:10px;pointer-events:none;';
                // document.body.appendChild(this.debugConsole);
                this.log('Debug console initialized. Fetching data...');

                // Classification filter properties
                this.showMemecoinTokens = true;
                this.showUtilityTokens = true;
                this.showAITokens = true;
                this.showTweetTokens = true;
                this.showCurrentEventTokens = true;
                this.showAnimalsTokens = true;
                this.showPoliticalTokens = true;
                this.showRacistTokens = false;
                this.showOffensiveTokens = false;

                // Auto-refresh properties
                this.refreshInterval = 30000;
                this.refreshTimer = null;
                this.lastUpdated = null;
                this.isRefreshing = false;
                this.lastUpdatedElement = document.getElementById('last-updated-text');
                this.refreshIndicator = document.getElementById('refresh-indicator');

                // Resize listener
                this.updateSafeDisplayArea();
                window.addEventListener('resize', () => this.updateSafeDisplayArea());
            }

            log(msg) {
                console.log(msg);

                if (this.debugConsole) {
                    const line = document.createElement('div');
                    line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                    this.debugConsole.appendChild(line);
                    this.debugConsole.scrollTop = this.debugConsole.scrollHeight;
                }
            }

            updateFinishLineLabel() {
                let style = document.getElementById('finish-line-style');

                if (!style) {
                    style = document.createElement('style');
                    style.id = 'finish-line-style';
                    document.head.appendChild(style);
                }

                style.textContent = `#finish-line::after {
                    content: "10M Market Cap";
                }

                `;
            }

            updateSafeDisplayArea() {
                const header = document.getElementById('race-header');
                this.headerHeight = header.offsetHeight + 20;

                const finishLine = document.getElementById('finish-line');
                const finishLineOffset = 60;

                finishLine.style.top = `${this.headerHeight + finishLineOffset}px`;

                const finishLinePosition = this.headerHeight + finishLineOffset;
                this.maxDisplayHeight = window.innerHeight - finishLinePosition - 80;

                const baseWidth = 1440;
                this.scaleFactor = Math.max(0.5, Math.min(1, window.innerWidth / baseWidth));

                if (this.filteredTokens.length > 0) {
                    this.calculateRacePositions();
                    this.renderTokenRacers();
                }
            }

            async fetchTokenData() {
                try {
                    if (this.isRefreshing) return;
                    this.isRefreshing = true;
                    this.refreshIndicator.classList.add('active');

                    const timestamp = new Date().getTime();

                    const response = await fetch(`trending_tokens_agent_research_desk.json?t=${timestamp}`);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();

                    const parseRelativeTime = (timeStr) => {
                        if (!timeStr) return null;
                        const now = new Date();
                        const parts = timeStr.match(/(\d+)\s+(minute|hour|day|week|month|year)/i);
                        if (!parts) return null;
                        const value = parseInt(parts[1]);
                        const unit = parts[2].toLowerCase();
                        let ms = 0;
                        if (unit.startsWith('minute')) ms = value * 60 * 1000;
                        else if (unit.startsWith('hour')) ms = value * 60 * 60 * 1000;
                        else if (unit.startsWith('day')) ms = value * 24 * 60 * 60 * 1000;
                        else if (unit.startsWith('week')) ms = value * 7 * 24 * 60 * 60 * 1000;
                        else if (unit.startsWith('month')) ms = value * 30 * 24 * 60 * 60 * 1000;
                        else if (unit.startsWith('year')) ms = value * 365 * 24 * 60 * 60 * 1000;
                        return new Date(now.getTime() - ms);
                    };

                    this.tokens = (data.tokens || []).map(entry => {
                        const details = entry.full_token_details || {};
                        const llmStaged = details.llm_staged_data || {};
                        const techAnalysis = details.technical_analysis || {};
                        const llmInterp = details.llm_interpretation || {};
                        const classifications = llmInterp.classifications || {};
                        const risk = details.risk_analysis || {};

                        let creationTime = parseRelativeTime(llmStaged.created);
                        if (!creationTime) {
                            creationTime = techAnalysis.creation_timestamp ? new Date(techAnalysis.creation_timestamp) : new Date(entry.processed_at);
                        }

                        let mcap = techAnalysis.usd_market_cap || 0;
                        if (!mcap) mcap = techAnalysis.market_cap || 0;

                        if (!mcap) {
                            mcap = Math.floor(Math.random() * (5000000 - 50000 + 1)) + 50000;
                        }

                        const isValidUrl = (str) => {
                            if (!str || typeof str !== 'string') return false;
                            const s = str.trim().toLowerCase();
                            return s.startsWith('http') || s.startsWith('www');
                        };

                        const scoreData = {
                            aggregate: details.aggregate_score || 0,
                            narrative: {
                                final: (details.groq_web_research?.narrative_score?.final_score) || 0,
                                sub: details.groq_web_research?.narrative_score?.narrative_subscores || {}
                            },
                            onchain: {
                                final: (risk.onchain_scan_score?.final_score) || 0,
                                sub: risk.onchain_scan_score || {}
                            },
                            alpha: {
                                final: (details.alpha_analysis?.alpha_score?.final_score) || 0,
                                sub: details.alpha_analysis?.alpha_score || {}
                            }
                        };

                        return {
                            name: entry.token_name,
                            symbol: entry.token_symbol,
                            token_address: entry.token_address,
                            usd_market_cap: mcap,
                            tokenTimestamp: creationTime,
                            image_uri: llmStaged.token_image,
                            description: llmInterp.llm_description,
                            website: isValidUrl(llmStaged.token_website) ? llmStaged.token_website : null,
                            twitter: isValidUrl(llmStaged.token_twitter) ? llmStaged.token_twitter : null,
                            telegram: null,
                            classifications: classifications,
                            risk_analysis: risk,
                            scores: scoreData,
                            launchpad: 'Unknown',
                            racePosition: 0,
                            horizontalPosition: 0
                        };
                    });

                    this.log(`Parsed ${this.tokens.length} tokens.`);

                    // Sort by timestamp
                    this.tokens.sort((a, b) => a.tokenTimestamp - b.tokenTimestamp);

                    // Find earliest and latest timestamps
                    if (this.tokens.length > 0) {
                        this.earliestTimestamp = this.tokens[0].tokenTimestamp;
                        this.latestTimestamp = this.tokens[this.tokens.length - 1].tokenTimestamp;
                    }

                    else {
                        this.log("No tokens found in data array.");
                    }

                    this.lastUpdated = new Date();
                    this.updateTimestamp();
                    this.applyFilters();

                    setTimeout(() => {
                        this.refreshIndicator.classList.remove('active');
                        this.isRefreshing = false;
                    }

                        , 500);

                }

                catch (error) {
                    console.error('Error fetching token data:', error);

                    this.log(`Error: ${error.message}`);
                    this.showToast('Error refreshing data', 2000, 'error');
                    this.refreshIndicator.classList.remove('active');
                    this.isRefreshing = false;
                }
            }

            startAutoRefresh() {
                if (this.refreshTimer) clearInterval(this.refreshTimer);
                this.refreshTimer = setInterval(() => this.fetchTokenData(), this.refreshInterval);

                console.log(`Auto-refresh enabled: ${this.refreshInterval / 1000}s`);
            }

            updateTimestamp() {
                if (!this.lastUpdated) return;
                const now = new Date();
                const diff = Math.floor((now - this.lastUpdated) / 1000);
                let timeText;

                if (diff < 60) timeText = `${diff} second${diff !== 1 ? 's' : ''} ago`;
                else if (diff < 3600) {
                    const min = Math.floor(diff / 60);
                    timeText = `${min} minute${min !== 1 ? 's' : ''} ago`;
                } else {
                    const hrs = Math.floor(diff / 3600);
                    timeText = `${hrs} hour${hrs !== 1 ? 's' : ''} ago`;
                }

                this.lastUpdatedElement.textContent = `Last updated: ${timeText}`;
            }

            applyFilters() {
                // Filter by market cap
                let filtered = this.tokens.filter(token => token.usd_market_cap >= this.minMarketCapFilter);

                // Filter by classifications
                this.filteredTokens = filtered.filter(token => {
                    const c = token.classifications || {}

                        ;
                    // If no classifications, show it (as per reference logic)
                    const hasAny = c.memecoin || c.utility || c.ai_token || c.tweet_coin || c.current_event || c.animals || c.political || c.racist || c.offensive;

                    if (!hasAny) return true;

                    // Hard blocks
                    if (c.racist && !this.showRacistTokens) return false;
                    if (c.offensive && !this.showOffensiveTokens) return false;

                    // Enabled categories
                    return (c.memecoin && this.showMemecoinTokens) || (c.utility && this.showUtilityTokens) || (c.ai_token && this.showAITokens) || (c.tweet_coin && this.showTweetTokens) || (c.current_event && this.showCurrentEventTokens) || (c.animals && this.showAnimalsTokens) || (c.political && this.showPoliticalTokens) || (c.racist && this.showRacistTokens) || (c.offensive && this.showOffensiveTokens);
                });

                this.calculateRacePositions();
                this.renderTokenRacers();
                this.updateTokenCounter();
                this.applySimpleViewMode();
            }

            handleClassificationFilterChange(filters) {
                this.showMemecoinTokens = filters.memecoin;
                this.showUtilityTokens = filters.utility;
                this.showAITokens = filters.ai;
                this.showTweetTokens = filters.tweet;
                this.showCurrentEventTokens = filters.currentEvent;
                this.showAnimalsTokens = filters.animals;
                this.showPoliticalTokens = filters.political;
                this.showRacistTokens = filters.racist;
                this.showOffensiveTokens = filters.offensive;

                this.applyFilters();
                this.showToast('Updated classification filters');
            }

            handleSimpleViewToggle(enabled) {
                this.simpleViewEnabled = enabled;
                this.applySimpleViewMode();
                const toggle = document.getElementById('simple-view-filter');
                if (toggle) toggle.checked = enabled;
                this.showToast(`${enabled ? 'Simple' : 'Normal'} view enabled`);
            }

            applySimpleViewMode() {
                if (this.simpleViewEnabled) {
                    this.raceTracks.classList.add('simple-view');
                }

                else {
                    this.raceTracks.classList.remove('simple-view');
                }
            }

            checkScreenSizeForSimpleView() {
                if (window.innerWidth <= 768 && !this.simpleViewEnabled) {
                    this.handleSimpleViewToggle(true);
                }
            }

            updateTokenCounter() {
                this.log(`Displaying ${this.filteredTokens.length} tokens out of ${this.tokens.length} total`);
            }

            handleMarketCapSliderChange(value) {
                this.minMarketCapFilter = parseInt(value);
                let displayValue;

                if (value >= 1000000) displayValue = `${(value / 1000000).toFixed(1)}M`;
                else if (value >= 1000) displayValue = `${(value / 1000).toFixed(0)}k`;
                else displayValue = value;

                const el = document.getElementById('market-cap-value');
                if (el) el.textContent = displayValue;

                this.applyFilters();
                this.showToast(`Min market cap: $${displayValue}`);
            }

            calculateRacePositions() {
                const trackWidth = this.raceTracks.clientWidth - 100;
                const finishLine = document.getElementById('finish-line');
                const finishLinePosition = finishLine.getBoundingClientRect().top;
                const startLinePosition = window.innerHeight;
                const availableHeight = startLinePosition - finishLinePosition - 40;

                const minMarketCap = this.startingMarketCap;
                const maxMarketCap = 100000000; // Updated to 100M

                // Create a sorted list of tokens (Newest to Oldest) to calculate visual positions
                const sortedTokens = [...this.filteredTokens].sort((a, b) => b.tokenTimestamp - a.tokenTimestamp);

                // Calculate cumulative "visual time" by capping large gaps
                let cumulativeTime = 0;
                const visualPositions = new Map();
                const GAP_LIMIT = 60 * 60 * 1000; // 1 hour cap for visual gaps

                if (sortedTokens.length > 0) {
                    visualPositions.set(sortedTokens[0], 0);

                    for (let i = 1; i < sortedTokens.length; i++) {
                        const prev = sortedTokens[i - 1]; // Newer
                        const curr = sortedTokens[i];     // Older
                        const diff = prev.tokenTimestamp - curr.tokenTimestamp;
                        const clampedDiff = Math.min(diff, GAP_LIMIT);
                        cumulativeTime += clampedDiff;
                        visualPositions.set(curr, cumulativeTime);
                    }
                }

                const totalVisualTime = cumulativeTime;

                this.filteredTokens.forEach(token => {
                    // Vertical Position (Market Cap)
                    const minLog = Math.log10(minMarketCap);
                    const maxLog = Math.log10(maxMarketCap);
                    const logRange = maxLog - minLog;

                    const mcap = Math.max(token.usd_market_cap, minMarketCap);
                    const logValue = Math.log10(mcap);
                    const ratio = (logValue - minLog) / logRange;

                    token.racePosition = Math.min(availableHeight * ratio, availableHeight);

                    // Horizontal Position (Time)
                    // Newest (vTime=0) -> Left (0)
                    // Oldest (vTime=total) -> Right (trackWidth)
                    if (totalVisualTime > 0) {
                        const vTime = visualPositions.get(token);
                        token.horizontalPosition = (vTime / totalVisualTime) * trackWidth;
                    } else {
                        token.horizontalPosition = trackWidth / 2; // Center if only one token
                    }
                });
            }

            showToast(message, duration = 2000, type = 'success') {
                this.toastElement.textContent = message;
                this.toastElement.classList.add('show');
                if (type === 'success') this.toastElement.style.backgroundColor = 'rgba(76, 175, 80, 0.9)';
                else if (type === 'error') this.toastElement.style.backgroundColor = 'rgba(244, 67, 54, 0.9)';

                setTimeout(() => {
                    this.toastElement.classList.remove('show');
                }

                    , duration);
            }

            formatNumber(num) {
                return num.toLocaleString('en-US', {
                    minimumFractionDigits: 0, maximumFractionDigits: 0
                });
            }

            renderTokenRacers() {
                const existingRacers = this.raceTracks.querySelectorAll('.token-racer');
                existingRacers.forEach(r => r.remove());

                let sharedInfoPanel = document.getElementById('shared-info-panel');

                if (!sharedInfoPanel) {
                    sharedInfoPanel = document.createElement('div');
                    sharedInfoPanel.id = 'shared-info-panel';
                    sharedInfoPanel.className = 'token-info';
                    document.body.appendChild(sharedInfoPanel);
                }

                const socialIconsHTML = {
                    website: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm7.931 9h-2.764a14.67 14.67 0 0 0-1.792-6.243A8.013 8.013 0 0 1 19.931 11zM12.53 4.027c1.035 1.364 2.427 3.78 2.627 6.973H9.03c.139-2.596.994-5.028 2.451-6.974.172-.01.34-.026.519-.026.179 0 .346.016.53.027zm-3.842.7C7.704 6.618 7.136 8.762 7.03 11H4.069a8.013 8.013 0 0 1 4.619-6.273zM4.069 13h2.974c.136 2.379.665 4.478 1.556 6.23A8.01 8.01 0 0 1 4.069 13zm7.381 6.973C10.049 18.275 9.222 15.896 9.041 13h6.113c-.208 2.773-1.117 5.196-2.603 6.972-.182.012-.364.028-.551.028-.186 0-.367-.016-.55-.027zm4.011-.772c.955-1.794 1.538-3.901 1.691-6.201h2.778a8.005 8.005 0 0 1-4.469 6.201z"/></svg>',
                    twitter: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98-3.56-.18-6.73-1.89-8.84-4.48-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg>',
                    telegram: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/></svg>'
                }

                    ;

                const tokenIconSize = Math.max(30, Math.round(60 * this.scaleFactor));
                const socialIconSize = Math.max(14, Math.round(24 * this.scaleFactor));

                this.filteredTokens.forEach(token => {
                    const racer = document.createElement('div');
                    racer.className = 'token-racer';

                    racer.style.bottom = `${token.racePosition}px`;
                    racer.style.left = `${token.horizontalPosition}px`;

                    const iconContainer = document.createElement('div');
                    iconContainer.className = 'token-icon-container';

                    iconContainer.style.width = `${tokenIconSize}px`;
                    iconContainer.style.height = `${tokenIconSize}px`;

                    // Classification indicators (simplified loop)
                    const c = token.classifications || {}

                        ;
                    const positions = ['pos-top', 'pos-top-right', 'pos-right', 'pos-bottom-right', 'pos-bottom', 'pos-bottom-left', 'pos-left', 'pos-top-left'];
                    let posIndex = 0;

                    const addInd = (type, emoji, title) => {
                        if (c[type]) {
                            const d = document.createElement('div');

                            d.className = `classification-indicator ${positions[posIndex % positions.length]}`;
                            d.textContent = emoji;
                            d.title = title;
                            iconContainer.appendChild(d);
                            posIndex++;
                        }
                    }

                        ;
                    addInd('memecoin', 'üòÇ', 'Memecoin');
                    addInd('utility', 'üõ†Ô∏è', 'Utility');
                    addInd('ai_token', 'ü§ñ', 'AI');
                    addInd('tweet_coin', 'üì±', 'Tweet');
                    addInd('current_event', 'üì∞', 'Current');
                    addInd('animals', 'üê±', 'Animal');
                    addInd('political', 'üèõÔ∏è', 'Political');
                    addInd('racist', 'üò≠', 'Racist');
                    addInd('offensive', 'üò°', 'Offensive');

                    const icon = document.createElement('img');
                    icon.className = 'token-icon';
                    icon.src = token.image_uri || 'logo.png';

                    icon.onerror = function () {
                        this.onerror = null;
                        this.src = 'https://via.placeholder.com/60?text=' + (token.symbol ? token.symbol.substring(0, 2) : '??');
                    }

                        ;

                    icon.style.width = `${tokenIconSize}px`;
                    icon.style.height = `${tokenIconSize}px`;

                    const socialIcons = document.createElement('div');
                    socialIcons.className = 'social-icons';

                    const addSocial = (type, url, html) => {
                        if (url) {
                            const a = document.createElement('a');
                            if (!url.startsWith('http')) url = 'https://' + url;
                            a.href = url;
                            a.target = '_blank';

                            a.className = `social-icon ${type}`;
                            a.innerHTML = html;
                            a.style.width = `${socialIconSize}px`;
                            a.style.height = `${socialIconSize}px`;
                            a.onclick = (e) => e.stopPropagation();
                            socialIcons.appendChild(a);
                        }
                    }

                        ;
                    addSocial('website', token.website, socialIconsHTML.website);
                    addSocial('twitter', token.twitter, socialIconsHTML.twitter);

                    const nameLabel = document.createElement('div');
                    nameLabel.className = 'token-name';
                    const nameText = token.name || 'Unknown';
                    nameLabel.textContent = nameText.length > 12 ? nameText.substring(0, 12) + '...' : nameText;
                    nameLabel.title = token.name;

                    const marketCapLabel = document.createElement('div');
                    marketCapLabel.className = 'token-market-cap';
                    const copyIcon = document.createElement('span');
                    copyIcon.className = 'copy-address-icon';
                    copyIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" ><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" /></svg>`;

                    copyIcon.onclick = (e) => {
                        e.stopPropagation();
                        navigator.clipboard.writeText(token.token_address);
                        this.showToast('Copied address!');
                    }

                        ;
                    marketCapLabel.appendChild(copyIcon);

                    marketCapLabel.appendChild(document.createTextNode(`$${this.formatNumber(token.usd_market_cap)}`));

                    const openPage = () => {
                        window.open(`https://dexscreener.com/solana/${token.token_address}`, '_blank');
                    };
                    icon.onclick = openPage;
                    nameLabel.onclick = openPage;

                    const now = new Date();
                    const ageMs = now - token.tokenTimestamp;
                    let ageText;
                    if (ageMs < 60 * 1000) ageText = `${Math.floor(ageMs / 1000)}s ago`;
                    else if (ageMs < 60 * 60 * 1000) ageText = `${Math.floor(ageMs / (60 * 1000))}m ago`;
                    else if (ageMs < 24 * 60 * 60 * 1000) ageText = `${Math.floor(ageMs / (60 * 60 * 1000))}h ago`;
                    else ageText = `${Math.floor(ageMs / (24 * 60 * 60 * 1000))}d ago`;

                    // Helper to generate a score bar HTML
                    const renderScoreBar = (label, value) => {
                        // Normalize various score formats to 0-10 range if needed
                        // Assuming input scores are roughly 0-10 or 0-100 based on JSON
                        // Aggregate is 0-10. Narrative/Onchain seem to be 0-10 too.
                        let pct = (value / 10) * 100;
                        if (pct > 100) pct = 100;

                        let colorClass = '';
                        if (value < 4) colorClass = 'danger';
                        else if (value < 7) colorClass = 'warning';

                        return `
                            <div class="score-row">
                                <div class="score-name" title="${label}">${label}</div>
                                <div class="score-bar-bg">
                                    <div class="score-bar-fill ${colorClass}" style="width: ${pct}%"></div>
                                </div>
                                <div class="score-val">${typeof value === 'number' ? value.toFixed(1) : value}</div>
                            </div>
                        `;
                    };

                    // Construct Score Section
                    const s = token.scores || {};
                    let scoreHTML = `
                        <div class="score-section">
                            <div class="score-head">Scores</div>
                            ${renderScoreBar('Aggregate', s.aggregate)}
                            ${renderScoreBar('Narrative', s.narrative?.final)}
                            ${renderScoreBar('Onchain', s.onchain?.final)}
                            ${renderScoreBar('Alpha', s.alpha?.final)}
                        </div>
                    `;

                    const infoHTML = `
                        <div class="token-info-header">
                            <strong>${token.name}</strong><br>
                            <small>${token.symbol}</small>
                        </div>
                        ${scoreHTML}
                        <div class="token-info-section">
                            <div class="token-info-label">Age:</div>
                            <div class="token-info-value">${ageText}</div>
                            <div class="token-info-label">Description:</div>
                            <div class="token-info-value">${token.description || 'No description'}</div>
                        </div>`;

                    const showTip = (e) => {
                        if (this.simpleViewEnabled) return;
                        sharedInfoPanel.innerHTML = infoHTML;
                        this.positionInfoPanel(sharedInfoPanel, e);
                        sharedInfoPanel.classList.add('visible');
                        racer.classList.add('expanded');
                    }

                        ;

                    const moveTip = (e) => {
                        if (this.simpleViewEnabled) return;
                        this.positionInfoPanel(sharedInfoPanel, e);
                    }

                        ;

                    const hideTip = () => {
                        sharedInfoPanel.classList.remove('visible');
                        racer.classList.remove('expanded');
                    }

                        ;

                    iconContainer.onmouseenter = showTip;
                    iconContainer.onmousemove = moveTip;
                    iconContainer.onmouseleave = hideTip;
                    nameLabel.onmouseenter = showTip;
                    nameLabel.onmousemove = moveTip;
                    nameLabel.onmouseleave = hideTip;

                    iconContainer.appendChild(icon);
                    iconContainer.appendChild(socialIcons);
                    racer.appendChild(iconContainer);
                    racer.appendChild(nameLabel);
                    racer.appendChild(marketCapLabel);
                    this.raceTracks.appendChild(racer);
                });
            }

            positionInfoPanel(panel, event) {
                // Get viewport dimensions
                const vw = window.innerWidth;
                const vh = window.innerHeight;

                // Get tooltip dimensions
                const rect = panel.getBoundingClientRect();
                const w = rect.width || 240; // fallback if not yet rendered
                const h = rect.height || 300; // estimated fallback

                // Initial position: Centered above cursor
                let left = event.clientX - (w / 2);
                let top = event.clientY - h - 20;

                // Horizontal checks
                if (left < 10) left = 10; // Left edge
                if (left + w > vw - 10) left = vw - w - 10; // Right edge

                // Vertical checks
                // If top goes off-screen (top < 0), try positioning below cursor
                if (top < 10) {
                    top = event.clientY + 20;

                    // If positioning below ALSO goes off-screen, just clamp it to bottom edge
                    if (top + h > vh - 10) {
                        top = vh - h - 10;
                    }
                }

                // Apply
                panel.style.left = `${left}px`;
                panel.style.top = `${top}px`;
            }

            init() {
                document.getElementById('market-cap-slider').addEventListener('input', (e) => this.handleMarketCapSliderChange(e.target.value));
                document.getElementById('simple-view-filter').addEventListener('change', (e) => this.handleSimpleViewToggle(e.target.checked));

                document.getElementById('filter-settings-button').addEventListener('click', () => {
                    const el = document.getElementById('filter-settings-container');
                    el.style.display = el.style.display === 'block' ? 'none' : 'block';
                });

                const map = {
                    'memecoin-filter': 'memecoin',
                    'utility-filter': 'utility',
                    'ai-filter': 'ai',
                    'tweet-filter': 'tweet',
                    'current-event-filter': 'currentEvent',
                    'animals-filter': 'animals',
                    'political-filter': 'political',
                    'racist-filter': 'racist',
                    'offensive-filter': 'offensive'
                }

                    ;

                const updateFilters = () => {
                    const status = {}

                        ;

                    for (const [id, key] of Object.entries(map)) {
                        const el = document.getElementById(id);
                        status[key] = el ? el.checked : false;
                    }

                    this.handleClassificationFilterChange(status);
                }

                    ;

                for (const id of Object.keys(map)) {
                    const el = document.getElementById(id);
                    if (el) el.addEventListener('change', updateFilters);
                }

                this.updateFinishLineLabel();
                this.fetchTokenData();
                this.startAutoRefresh();
                this.checkScreenSizeForSimpleView();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const race = new TokenRace();
            race.init();
        });

        function toggleMenu() {
            document.getElementById("dropdown-menu").classList.toggle("show");
        }

    </script>
</body>

</html>